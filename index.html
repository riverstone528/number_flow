<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ë„˜ë²„ í”Œë¡œìš°</title>
<link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:       #fff9f0;
    --surface:  #ffffff;
    --card:     #fffdf8;
    --border:   #f0e6d3;
    --sky:      #5bc8f5;
    --grass:    #6dd47e;
    --sun:      #ffcc44;
    --coral:    #ff7c6e;
    --lavender: #b39ddb;
    --peach:    #ffb347;
    --text:     #3d2c1e;
    --muted:    #b0948a;
    --white:    #ffffff;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html {
    height: 100%;
    overflow: hidden;
    position: fixed;
    width: 100%;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    height: 100%;
    width: 100%;
    overflow: hidden;
    position: fixed;
    top: 0; left: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    touch-action: none;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 60px 40px at 10% 12%, rgba(91,200,245,0.18) 0%, transparent 100%),
      radial-gradient(ellipse 90px 55px at 80% 8%,  rgba(91,200,245,0.13) 0%, transparent 100%),
      radial-gradient(ellipse 50px 35px at 55% 5%,  rgba(91,200,245,0.10) 0%, transparent 100%),
      radial-gradient(circle 3px at 20% 25%, rgba(255,204,68,0.6) 0%, transparent 100%),
      radial-gradient(circle 2px at 75% 18%, rgba(255,204,68,0.5) 0%, transparent 100%),
      radial-gradient(circle 3px at 45% 35%, rgba(255,204,68,0.4) 0%, transparent 100%),
      radial-gradient(circle 2px at 90% 40%, rgba(255,204,68,0.5) 0%, transparent 100%);
    pointer-events: none;
    z-index: 0;
  }
  .app {
    width: 100%;
    max-width: 420px;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 1;
    overflow: hidden;
  }
  .screen { display: none; flex-direction: column; flex: 1; overflow: hidden; }
  .screen.active { display: flex; }

  /* HOME */
  .logo-wrap { text-align: center; padding: 0.5rem 0 0; }
  .logo-icon {
    display: block;
    margin: 0 auto;
    animation: float 3s ease-in-out infinite;
    filter: drop-shadow(0 8px 18px rgba(109,212,126,0.4)) drop-shadow(0 3px 6px rgba(0,0,0,0.1));
    width: 120px; height: 130px;
  }
  @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
  .logo-title {
    font-family: 'Gaegu', cursive;
    font-size: 2.4rem;
    font-weight: 700;
    color: var(--coral);
    text-shadow: 3px 3px 0 rgba(255,124,110,0.2);
    margin-top: 0.2rem;
  }
  .logo-sub { font-family: 'Gaegu', cursive; font-size: 1rem; color: var(--muted); margin-top: 0.1rem; }
  .home-desc {
    background: var(--white);
    border: 2.5px solid var(--border);
    border-radius: 20px;
    padding: 1rem 1.2rem;
    font-size: 0.88rem;
    color: var(--muted);
    line-height: 1.8;
    text-align: center;
    box-shadow: 0 4px 0 var(--border);
    position: relative;
  }
  .home-desc::before { content:'ğŸ’¡'; position:absolute; top:-14px; left:50%; transform:translateX(-50%); font-size:1.3rem; }
  .home-desc strong { color: var(--coral); font-weight: 700; }
  .section-label { font-family:'Gaegu',cursive; font-size:1.1rem; color:var(--muted); margin-bottom:0.2rem; }
  .levels-grid { display:flex; flex-direction:column; gap:0.8rem; width:100%; }
  .level-btn {
    background: var(--white);
    border: 2.5px solid var(--border);
    border-radius: 20px;
    padding: 1rem 1.2rem;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    display: flex;
    align-items: center;
    gap: 0.9rem;
    text-align: left;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 0 var(--border);
  }
  .level-btn:active { transform:translateY(3px); box-shadow:0 1px 0 var(--border); }
  .level-btn::before { content:''; position:absolute; left:0; top:0; bottom:0; width:5px; border-radius:20px 0 0 20px; }
  #btn-easy::before   { background: var(--grass); }
  #btn-medium::before { background: var(--sky); }
  #btn-hard::before   { background: var(--coral); }
  .level-btn.locked { cursor:not-allowed; pointer-events:none; opacity:0.6; padding-bottom:2.6rem; }
  .level-btn.locked .level-icon,
  .level-btn.locked .level-info,
  .level-btn.locked .level-best { opacity:0.4; }
  .level-icon { font-size:2rem; flex-shrink:0; }
  .level-info { flex:1; display:flex; flex-direction:column; gap:0.2rem; }
  .level-top  { display:flex; align-items:center; gap:0.5rem; }
  .level-name { font-family:'Gaegu',cursive; font-size:1.2rem; font-weight:700; color:var(--text); }
  .level-stars { font-size:0.65rem; color:var(--sun); letter-spacing:2px; }
  .level-desc  { font-size:0.75rem; color:var(--muted); line-height:1.4; }
  .level-best  { font-family:'Gaegu',cursive; font-size:0.95rem; font-weight:700; color:var(--peach); flex-shrink:0; white-space:nowrap; }
  .level-lock-bar {
    display:none; position:absolute; bottom:0; left:0; right:0;
    background:rgba(255,124,110,0.08); border-top:2px dashed rgba(255,124,110,0.3);
    border-radius:0 0 18px 18px; padding:0.4rem 1rem;
    flex-direction:row; align-items:center; gap:0.4rem; z-index:2;
  }
  .level-btn.locked .level-lock-bar { display:flex; }
  .lock-icon { font-size:0.8rem; }
  .lock-text  { font-family:'Gaegu',cursive; font-size:0.85rem; color:var(--coral); font-weight:700; }

  /* GAME SCREEN */
  #gameScreen { padding:0; position:relative; background:var(--bg); }
  .game-header {
    padding:0.9rem 1.2rem; display:flex; align-items:center; gap:0.8rem;
    background:var(--white); border-bottom:2.5px solid var(--border);
  }
  .back-btn {
    width:40px; height:40px; border-radius:50%;
    border:2.5px solid var(--border); background:var(--bg); color:var(--text);
    font-size:1.1rem; cursor:pointer; display:flex; align-items:center; justify-content:center;
    flex-shrink:0; transition:transform 0.15s; box-shadow:0 3px 0 var(--border);
  }
  .back-btn:active { transform:translateY(2px); box-shadow:0 1px 0 var(--border); }
  .game-info { flex:1; }
  .level-label { font-family:'Gaegu',cursive; font-size:0.8rem; color:var(--muted); }
  .puzzle-num  { font-family:'Gaegu',cursive; font-size:1.1rem; font-weight:700; color:var(--text); }
  .timer-wrap {
    padding:0.65rem 1.2rem; background:var(--white); border-bottom:2.5px solid var(--border);
    display:flex; align-items:center; gap:0.8rem;
  }
  .timer-label { font-family:'Gaegu',cursive; font-size:0.8rem; color:var(--muted); flex-shrink:0; width:4.5rem; }
  .timer-val {
    font-family:'Gaegu',cursive; font-size:1.2rem; font-weight:700; color:var(--text);
    flex-shrink:0; width:6rem; text-align:right; font-variant-numeric:tabular-nums; white-space:nowrap;
  }
  .q-dots { display:flex; gap:7px; align-items:center; flex:1; justify-content:center; }
  .q-dot { width:10px; height:10px; border-radius:50%; background:var(--border); transition:all 0.3s; }
  .q-dot.done    { background:var(--grass); box-shadow:0 0 0 2px rgba(109,212,126,0.3); }
  .q-dot.current { background:var(--sun); box-shadow:0 0 0 3px rgba(255,204,68,0.3); transform:scale(1.35); }
  .target-area {
    margin:1rem 1.2rem 0.5rem;
    background:var(--white); border:2.5px solid var(--border); border-radius:24px;
    padding:1.2rem 1.5rem 1.4rem; display:flex; flex-direction:column; align-items:center; gap:0.6rem;
    box-shadow:0 4px 0 var(--border); transition:border-color 0.2s, background 0.2s;
  }
  .target-label { font-family:'Gaegu',cursive; font-size:1rem; color:var(--muted); }
  @keyframes slideInDown {
    0%  { transform:translateY(-20px); opacity:0; }
    60% { transform:translateY(2px);   opacity:1; }
    100%{ transform:translateY(0);     opacity:1; }
  }
  .target-area.slide-in { animation:slideInDown 0.35s cubic-bezier(0.22,1,0.36,1) forwards; }
  @keyframes wrongShake {
    0%,100%{transform:translateX(0)} 15%{transform:translateX(-8px)} 35%{transform:translateX(8px)} 55%{transform:translateX(-5px)} 75%{transform:translateX(5px)}
  }
  .target-area.wrong { animation:wrongShake 0.4s ease; border-color:var(--coral); background:rgba(255,124,110,0.06); }
  .hint-formula { display:flex; align-items:center; justify-content:center; gap:0.6rem; flex-wrap:wrap; }
  .hint-box {
    font-family:'Gaegu',cursive; font-size:2.6rem; font-weight:700;
    min-width:3.6rem; height:3.8rem; display:flex; align-items:center; justify-content:center;
    border-radius:16px; border:2.5px dashed var(--border); background:var(--bg); color:var(--muted);
    transition:all 0.15s; padding:0 0.5rem; box-shadow:0 3px 0 var(--border);
  }
  .hint-box.filled {
    border-style:solid; border-color:var(--sky); background:rgba(91,200,245,0.12); color:#1a8ab5;
    box-shadow:0 3px 0 rgba(91,200,245,0.4); animation:popIn 0.2s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes popIn { 0%{transform:scale(0.75)} 100%{transform:scale(1)} }
  .hint-box.wrong-flash {
    border-style:solid !important; border-color:var(--coral) !important;
    background:rgba(255,124,110,0.12) !important; color:var(--coral) !important;
    box-shadow:0 3px 0 rgba(255,124,110,0.3) !important;
  }
  .hint-op     { font-family:'Gaegu',cursive; font-size:2.2rem; font-weight:700; color:var(--muted); }
  .hint-eq     { font-family:'Gaegu',cursive; font-size:2.2rem; font-weight:700; color:var(--muted); }
  .hint-target { font-family:'Gaegu',cursive; font-size:2.8rem; font-weight:700; color:var(--coral); text-shadow:2px 2px 0 rgba(255,124,110,0.2); }
  .grid-wrap { padding:0.5rem 1.2rem; flex:1; }
  .num-grid  { display:grid; gap:8px; }
  .num-cell {
    aspect-ratio:1; border-radius:16px; background:var(--white); border:2.5px solid var(--border);
    display:flex; align-items:center; justify-content:center;
    font-family:'Gaegu',cursive; font-size:2.2rem; font-weight:700;
    cursor:pointer; transition:transform 0.12s, box-shadow 0.12s, border-color 0.12s, background 0.12s;
    user-select:none; -webkit-user-select:none; box-shadow:0 3px 0 var(--border); color:var(--text);
    position:relative;
  }
  .num-cell:active  { transform:translateY(2px); box-shadow:0 1px 0 var(--border); }
  .num-cell.selected {
    border-color:var(--sky); background:rgba(91,200,245,0.15); color:#1a8ab5;
    box-shadow:0 3px 0 rgba(91,200,245,0.4); transform:translateY(-2px) scale(1.05);
  }
  .num-cell.used {
    border-color:var(--border); background:rgba(109,212,126,0.1); color:var(--grass);
    cursor:default; border-style:dashed; box-shadow:none;
  }
  .num-cell.used::after { content:'âœ“'; position:absolute; font-size:0.6rem; top:3px; right:5px; color:var(--grass); }
  .action-bar { padding:0.7rem 1.2rem 1.2rem; display:flex; gap:0.7rem; }
  .action-btn {
    flex:1; padding:0.85rem; border-radius:16px; border:2.5px solid var(--border);
    background:var(--white); color:var(--text); font-family:'Gaegu',cursive; font-size:1rem;
    cursor:pointer; transition:transform 0.12s, box-shadow 0.12s; box-shadow:0 4px 0 var(--border);
  }
  .action-btn:active { transform:translateY(3px); box-shadow:0 1px 0 var(--border); }
  .action-btn.primary { background:var(--grass); color:var(--white); border-color:#4db863; box-shadow:0 4px 0 #4db863; font-weight:700; }
  .action-btn.primary:active { box-shadow:0 1px 0 #4db863; }
  .action-btn.amber   { background:var(--peach); color:var(--white); border-color:#e09030; box-shadow:0 4px 0 #e09030; font-weight:700; }
  .action-btn.amber:active   { box-shadow:0 1px 0 #e09030; }

  /* COUNTDOWN */
  .countdown-overlay {
    display:none; position:absolute; inset:0; background:rgba(255,249,240,0.9);
    backdrop-filter:blur(4px); z-index:50; align-items:center; justify-content:center; flex-direction:column; gap:0.5rem;
  }
  .countdown-overlay.show { display:flex; }
  .countdown-num {
    font-family:'Gaegu',cursive; font-size:8rem; font-weight:700; color:var(--coral);
    line-height:1; animation:countPop 0.9s ease forwards; filter:drop-shadow(4px 4px 0 rgba(255,124,110,0.25));
    text-align:center; width:100%;
  }
  .countdown-label { font-family:'Gaegu',cursive; font-size:1.1rem; color:var(--muted); }
  @keyframes countPop { 0%{transform:scale(1.5);opacity:0} 25%{transform:scale(1);opacity:1} 80%{transform:scale(1);opacity:1} 100%{transform:scale(0.7);opacity:0} }

  /* RESULT */
  .overlay {
    display:none; position:fixed; inset:0; background:rgba(61,44,30,0.45);
    backdrop-filter:blur(6px); z-index:100; flex-direction:column;
    align-items:center; justify-content:center; padding:1.5rem;
  }
  .overlay.show { display:flex; }
  .result-card {
    background:var(--white); border:3px solid var(--border); border-radius:28px;
    padding:2rem 1.8rem; width:100%; max-width:340px; text-align:center;
    animation:popInCard 0.4s cubic-bezier(0.34,1.56,0.64,1);
    position:relative; overflow:hidden; box-shadow:0 8px 0 var(--border);
  }
  @keyframes popInCard { 0%{transform:scale(0.7);opacity:0} 100%{transform:scale(1);opacity:1} }
  .result-card.new-record { background:linear-gradient(160deg,#fff9e6,#fff3f0); border-color:var(--sun); box-shadow:0 8px 0 rgba(255,204,68,0.5); }
  .result-card.new-record::before {
    content:''; position:absolute; inset:0;
    background:repeating-linear-gradient(45deg,transparent,transparent 20px,rgba(255,204,68,0.04) 20px,rgba(255,204,68,0.04) 40px);
    pointer-events:none;
  }
  .result-card.new-record .result-title     { color:var(--peach); }
  .result-card.new-record .result-time-val  { color:var(--peach); }
  .result-icon  { font-size:3.5rem; margin-bottom:0.5rem; animation:float 2s ease-in-out infinite; }
  .result-title { font-family:'Gaegu',cursive; font-size:2rem; font-weight:700; color:var(--coral); margin-bottom:1rem; }
  .result-time-wrap { margin-bottom:0.8rem; }
  .result-time-label { font-family:'Gaegu',cursive; font-size:0.85rem; color:var(--muted); margin-bottom:0.2rem; }
  .result-time-val { font-family:'Gaegu',cursive; font-size:3rem; font-weight:700; color:var(--text); line-height:1; }
  .q-times { display:flex; gap:0.4rem; justify-content:center; margin-bottom:1rem; flex-wrap:wrap; }
  .q-time-chip {
    background:var(--bg); border:2px solid var(--border); border-radius:10px; padding:0.3rem 0.6rem;
    font-family:'Gaegu',cursive; font-size:0.75rem; color:var(--muted);
    display:flex; flex-direction:column; align-items:center; gap:0.05rem; box-shadow:0 2px 0 var(--border);
  }
  .q-time-chip .chip-label { font-size:0.6rem; opacity:0.6; }
  .q-time-chip .chip-val   { color:var(--text); }
  .q-time-chip.best-q { border-color:var(--grass); }
  .q-time-chip.best-q .chip-val { color:var(--grass); }
  .result-best-row {
    display:flex; align-items:center; justify-content:center; gap:0.4rem; margin-bottom:1rem;
    font-family:'Gaegu',cursive; font-size:0.9rem; color:var(--muted);
  }
  .result-best-row span { color:var(--peach); font-weight:700; }
  .result-btns { display:flex; flex-direction:column; gap:0.7rem; }
  .confetti-piece {
    position:fixed; width:10px; height:10px; border-radius:3px;
    pointer-events:none; animation:confettiFall linear forwards; z-index:200;
  }
  @keyframes confettiFall { 0%{transform:translateY(-20px) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(720deg);opacity:0} }

  /* ì •ë‹µ í”¼ë“œë°± */
  @keyframes cellBurst {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.15); }
    100% { transform: scale(1); }
  }
  .num-cell.correct-burst { animation: cellBurst 0.3s ease forwards; }

  @keyframes cellFillGreen {
    0%   { background: var(--white); border-color: var(--border); color: var(--text); }
    100% { background: var(--grass); border-color: #4db863; color: #fff; box-shadow: 0 4px 0 #4db863; }
  }
  .num-cell.used {
    background: var(--grass); border-color: #4db863; color: #fff;
    cursor: default; box-shadow: 0 4px 0 #4db863;
    animation: cellFillGreen 0.3s ease forwards;
  }
  .num-cell.used::after { content:'âœ“'; position:absolute; font-size:0.7rem; top:3px; right:5px; color:rgba(255,255,255,0.8); }
  .star-particle {
    position: fixed;
    pointer-events: none;
    z-index: 95;
    animation: starFly linear forwards;
    transform-origin: center;
  }
  @keyframes starFly {
    0%   { transform: translate(0,0) scale(1.2) rotate(0deg); opacity: 1; }
    60%  { opacity: 1; }
    100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(var(--rot)); opacity: 0; }
  }
</style>
</head>
<body>
<div class="app">

  <!-- HOME -->
  <div class="screen active" id="homeScreen">
    <div style="padding:1.5rem 1.2rem 2rem; display:flex; flex-direction:column; gap:1.2rem; flex:1;">
      <div class="logo-wrap">
        <span class="logo-icon">
          <svg width="120" height="130" viewBox="0 0 120 130" fill="none" xmlns="http://www.w3.org/2000/svg">

            <!-- ì™¼íŒ” (êµ¬ë¶ˆêµ¬ë¶ˆí•˜ê²Œ ë»—ìŒ) -->
            <path d="M18 58 C8 52 2 44 6 36" stroke="#4db863" stroke-width="7" stroke-linecap="round" fill="none"/>
            <!-- ì™¼ì† -->
            <circle cx="6" cy="33" r="6" fill="#6dd47e" stroke="#4db863" stroke-width="2"/>

            <!-- ì˜¤ë¥¸íŒ” (ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ) -->
            <path d="M102 58 C112 50 118 42 116 33" stroke="#4db863" stroke-width="7" stroke-linecap="round" fill="none"/>
            <!-- ì˜¤ë¥¸ì† -->
            <circle cx="116" cy="30" r="6" fill="#6dd47e" stroke="#4db863" stroke-width="2"/>

            <!-- ë”í•˜ê¸° ëª¸í†µ ì„¸ë¡œ ë§‰ëŒ€ -->
            <rect x="40" y="10" width="40" height="100" rx="10" fill="#6dd47e"/>
            <!-- ë”í•˜ê¸° ëª¸í†µ ê°€ë¡œ ë§‰ëŒ€ -->
            <rect x="8" y="42" width="104" height="36" rx="10" fill="#6dd47e"/>

            <!-- ê²©ì íŒ¨í„´ - ì„¸ë¡œ ë§‰ëŒ€ -->
            <line x1="52" y1="10" x2="52" y2="110" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="64" y1="10" x2="64" y2="110" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="76" y1="10" x2="76" y2="110" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="40" y1="22" x2="80" y2="22" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="40" y1="34" x2="80" y2="34" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="40" y1="88" x2="80" y2="88" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="40" y1="100" x2="80" y2="100" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <!-- ê²©ì íŒ¨í„´ - ê°€ë¡œ ë§‰ëŒ€ -->
            <line x1="40" y1="54" x2="80" y2="54" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="40" y1="66" x2="80" y2="66" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="8"  y1="54" x2="40" y2="54" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="8"  y1="66" x2="40" y2="66" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="20" y1="42" x2="20" y2="78" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="32" y1="42" x2="32" y2="78" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="80" y1="54" x2="112" y2="54" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="80" y1="66" x2="112" y2="66" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="88" y1="42" x2="88" y2="78" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>
            <line x1="100" y1="42" x2="100" y2="78" stroke="#4db863" stroke-width="1.5" opacity="0.6"/>

            <!-- ëˆˆ í°ì -->
            <ellipse cx="50" cy="62" rx="10" ry="11" fill="white"/>
            <ellipse cx="70" cy="62" rx="10" ry="11" fill="white"/>
            <!-- ëˆˆë™ì -->
            <circle cx="52" cy="64" r="6" fill="#1a1a2e"/>
            <circle cx="72" cy="64" r="6" fill="#1a1a2e"/>
            <!-- ëˆˆ í•˜ì´ë¼ì´íŠ¸ -->
            <circle cx="54.5" cy="61.5" r="2.5" fill="white"/>
            <circle cx="74.5" cy="61.5" r="2.5" fill="white"/>

            <!-- ë³¼í„°ì¹˜ -->
            <ellipse cx="42" cy="72" rx="5" ry="3" fill="#ff9f95" opacity="0.7"/>
            <ellipse cx="78" cy="72" rx="5" ry="3" fill="#ff9f95" opacity="0.7"/>

            <!-- ì… -->
            <path d="M52 76 Q60 83 68 76" stroke="#1a1a2e" stroke-width="2.5" stroke-linecap="round" fill="none"/>

            <!-- ì™¼ë‹¤ë¦¬ (ì‚´ì§ ë°”ê¹¥ìœ¼ë¡œ ë²Œì–´ì§„ ëŠë‚Œ) -->
            <path d="M52 108 C50 116 46 122 44 128" stroke="#3a3a3a" stroke-width="7" stroke-linecap="round" fill="none"/>
            <!-- ì™¼ë°œ -->
            <path d="M40 127 C42 130 50 130 52 127" stroke="#2a2a2a" stroke-width="5" stroke-linecap="round" fill="none"/>

            <!-- ì˜¤ë¥¸ë‹¤ë¦¬ -->
            <path d="M68 108 C70 116 74 122 76 128" stroke="#3a3a3a" stroke-width="7" stroke-linecap="round" fill="none"/>
            <!-- ì˜¤ë¥¸ë°œ -->
            <path d="M72 127 C74 130 82 130 84 127" stroke="#2a2a2a" stroke-width="5" stroke-linecap="round" fill="none"/>

          </svg>
        </span>
        <div class="logo-title">ë„˜ë²„ í”Œë¡œìš°</div>
        <div class="logo-sub">5ë¬¸ì œë¥¼ ìµœëŒ€í•œ ë¹ ë¥´ê²Œ í’€ì–´ë¼!</div>
      </div>
      <div class="home-desc">
        ìˆ«ìë¥¼ íƒ­í•´ì„œ ê³ ë¥´ê³ ,<br>
        í•©ê³„ê°€ <strong>ëª©í‘œ ìˆ«ì</strong>ì™€ ë§ìœ¼ë©´ ìë™ìœ¼ë¡œ ë„˜ì–´ê°€ìš”!<br>
        <strong>5ë¬¸ì œ</strong>ë¥¼ ê°€ì¥ ë¹ ë¥´ê²Œ í‘¸ëŠ” ê²Œ ëª©í‘œ ğŸ¯
      </div>
      <div>
        <div class="section-label">âœï¸ ë‚œì´ë„ë¥¼ ì„ íƒí•´ìš”</div>
        <div class="levels-grid">
          <div class="level-btn" onclick="startGame('easy')" id="btn-easy">
            <span class="level-icon">ğŸ£</span>
            <div class="level-info">
              <div class="level-top"><span class="level-name">ì‰¬ì›€</span><span class="level-stars">â˜…â˜†â˜†</span></div>
              <span class="level-desc">3Ã—3 ì¹¸ Â· 1~9 ìˆ«ì Â· 2ê°œ ë”í•˜ê¸°</span>
            </div>
            <span class="level-best" id="best-easy"></span>
          </div>
          <div class="level-btn" onclick="startGame('medium')" id="btn-medium">
            <span class="level-icon">ğŸ¬</span>
            <div class="level-info">
              <div class="level-top"><span class="level-name">ë³´í†µ</span><span class="level-stars">â˜…â˜…â˜†</span></div>
              <span class="level-desc">4Ã—4 ì¹¸ Â· 1~20 ìˆ«ì Â· 2ê°œ ë”í•˜ê¸°</span>
            </div>
            <span class="level-best" id="best-medium"></span>
            <div class="level-lock-bar"><span class="lock-icon">ğŸ”’</span><span class="lock-text">ì‰¬ì›€ì„ í´ë¦¬ì–´í•˜ë©´ ì—´ë ¤ìš”!</span></div>
          </div>
          <div class="level-btn" onclick="startGame('hard')" id="btn-hard">
            <span class="level-icon">ğŸ¦</span>
            <div class="level-info">
              <div class="level-top"><span class="level-name">ì–´ë ¤ì›€</span><span class="level-stars">â˜…â˜…â˜…</span></div>
              <span class="level-desc">4Ã—4 ì¹¸ Â· 1~10 ìˆ«ì Â· 3ê°œ ë”í•˜ê¸°</span>
            </div>
            <span class="level-best" id="best-hard"></span>
            <div class="level-lock-bar"><span class="lock-icon">ğŸ”’</span><span class="lock-text">ë³´í†µì„ í´ë¦¬ì–´í•˜ë©´ ì—´ë ¤ìš”!</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div class="screen" id="gameScreen" style="position:relative;">
    <div class="countdown-overlay" id="countdownOverlay">
      <div class="countdown-num" id="countdownNum">3</div>
      <div class="countdown-label">ì¤€ë¹„í•˜ì„¸ìš”! ğŸµ</div>
    </div>
    <div class="game-header">
      <button class="back-btn" onclick="goHome()">â†</button>
      <div class="game-info">
        <div class="level-label" id="levelLabel">ì‰¬ì›€</div>
        <div class="puzzle-num" id="puzzleNum">1 / 5</div>
      </div>
    </div>
    <div class="timer-wrap">
      <span class="timer-label">â± ì´ ì‹œê°„</span>
      <div class="q-dots" id="qDots"></div>
      <span class="timer-val" id="timerDisp">0.0ì´ˆ</span>
    </div>
    <div class="target-area">
      <div class="target-label">ğŸ¯ ëª©í‘œ í•©ê³„</div>
      <div class="hint-formula" id="hintFormula"></div>
    </div>
    <div class="grid-wrap">
      <div class="num-grid" id="numGrid"></div>
    </div>

  </div>

</div>

<!-- Result Overlay -->
<div class="overlay" id="overlay">
  <div class="result-card" id="resultCard">
    <div class="result-icon" id="resIcon">ğŸ‰</div>
    <div class="result-title" id="resTitle">ì™„ë£Œ!</div>
    <div class="result-time-wrap">
      <div class="result-time-label">ì´ ê±¸ë¦° ì‹œê°„</div>
      <div class="result-time-val" id="resTotalTime">0.0ì´ˆ</div>
    </div>
    <div class="q-times" id="qTimes"></div>
    <div class="result-best-row" id="resBestRow" style="display:none;">ìµœê³ ê¸°ë¡ <span id="resBest">â€“</span></div>
    <div class="result-btns">
      <button class="action-btn primary" id="replayBtn" onclick="replayLevel()" style="padding:1.1rem;font-size:1.05rem;">â†º í•œ ë²ˆ ë”!</button>
      <button class="action-btn" onclick="goHome()" style="padding:1.1rem;font-size:1.05rem;">ğŸ  í™ˆìœ¼ë¡œ</button>
    </div>
  </div>
</div>

<script>
// ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤/í™”ë©´ ì´ë™ ì™„ì „ ë°©ì§€
document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
document.addEventListener('touchstart', e => { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });
const TOTAL_Q = 5;
const LOCK_ENABLED = false;
const LEVELS = {
  easy:   { gridSize: 3, maxNum: 9,  solCount: 2 },
  medium: { gridSize: 4, maxNum: 20, solCount: 2 },
  hard:   { gridSize: 4, maxNum: 10, solCount: 3 },
};

let state = {
  level: 'easy', numbers: [], target: 0, selected: [], _solution: [],
  qIndex: 0, qTimes: [], qStart: 0, elapsed: 0, timerInterval: null,
  best: { easy: null, medium: null, hard: null },
  cleared: { easy: false, medium: false, hard: false },
};

updateHomeDisplay();

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goHome() {
  clearInterval(state.timerInterval);
  document.getElementById('overlay').classList.remove('show');
  document.getElementById('resultCard').classList.remove('new-record');
  updateHomeDisplay();
  showScreen('homeScreen');
}

function updateHomeDisplay() {
  ['easy','medium','hard'].forEach(level => {
    const best = state.best[level];
    document.getElementById(`best-${level}`).textContent = best !== null ? `ğŸ† ${(best/10).toFixed(1)}ì´ˆ` : '';
  });
  updateLockState();
}

function updateLockState() {
  if (!LOCK_ENABLED) { ['medium','hard'].forEach(l => document.getElementById(`btn-${l}`).classList.remove('locked')); return; }
  document.getElementById('btn-medium').classList.toggle('locked', !state.cleared.easy);
  document.getElementById('btn-hard').classList.toggle('locked', !state.cleared.medium);
}

function startGame(level) {
  state.level = level; state.qIndex = 0; state.qTimes = []; state.elapsed = 0; state.selected = [];
  loadQuestion();
  showScreen('gameScreen');
  startCountdown(() => startTimer());
}

function loadQuestion() {
  clearInterval(state.timerInterval);
  const cfg = LEVELS[state.level];
  const size = cfg.gridSize * cfg.gridSize;
  state.selected = [];
  state.qStart = state.elapsed;

  const solCount = cfg.solCount;
  const solutionNums = Array.from({length: solCount}, () => Math.floor(Math.random() * cfg.maxNum) + 1);
  state.target = solutionNums.reduce((s, n) => s + n, 0);

  state.numbers = Array.from({length: size}, () => {
    if (state.level === 'easy') {
      return Math.floor(Math.random() * cfg.maxNum) + 1;
    }
    let n;
    do { n = Math.floor(Math.random() * cfg.maxNum) + 1; } while (n >= state.target);
    return n;
  });

  const idxs = shuffle([...Array(size).keys()]).slice(0, solCount);
  idxs.forEach((idx, i) => { state.numbers[idx] = solutionNums[i]; });
  state._solution = idxs;

  // ì‰¬ì›€: ì²« ë²ˆì§¸ ì •ë‹µ ìˆ«ìë¥¼ ìˆ˜ì‹ì— íŒíŠ¸ë¡œ ê³ ì •, selected/preselected ì—†ìŒ
  state._hint = solutionNums[0];
  state.selected = [];

  const labels = { easy:'ğŸ£ ì‰¬ì›€', medium:'ğŸ¬ ë³´í†µ', hard:'ğŸ¦ ì–´ë ¤ì›€' };
  document.getElementById('levelLabel').textContent = labels[state.level];
  document.getElementById('puzzleNum').textContent  = `${state.qIndex + 1} / ${TOTAL_Q}`;
  renderDots(); renderGrid(); renderFormula();
}

function renderDots() {
  const wrap = document.getElementById('qDots');
  wrap.innerHTML = '';
  for (let i = 0; i < TOTAL_Q; i++) {
    const d = document.createElement('div');
    d.className = 'q-dot' + (i < state.qIndex ? ' done' : i === state.qIndex ? ' current' : '');
    wrap.appendChild(d);
  }
}

function renderGrid() {
  const cfg = LEVELS[state.level];
  const grid = document.getElementById('numGrid');
  grid.style.gridTemplateColumns = `repeat(${cfg.gridSize}, 1fr)`;
  grid.innerHTML = '';
  state.numbers.forEach((n, i) => {
    const cell = document.createElement('div');
    cell.className = 'num-cell';
    cell.textContent = n;
    cell.dataset.idx = i;
    cell.onclick = () => toggleCell(i, cell);
    grid.appendChild(cell);
  });
}

function toggleCell(idx, cell) {
  if (cell.classList.contains('used')) return;
  const pos = state.selected.indexOf(idx);
  if (pos >= 0) { state.selected.splice(pos, 1); cell.classList.remove('selected'); }
  else          { state.selected.push(idx);       cell.classList.add('selected'); }
  renderFormula();

  // ì‰¬ì›€: 1ê°œ ì„ íƒ ì‹œ ë°”ë¡œ íŒì • (íŒíŠ¸ ìˆ«ì + ì„ íƒ ìˆ«ì)
  // ë³´í†µ/ì–´ë ¤ì›€: solCountë§Œí¼ ì„ íƒ ì‹œ íŒì •
  // íŒíŠ¸ ì œì™¸ ë‚˜ë¨¸ì§€ ê°œìˆ˜ë§Œí¼ ì„ íƒí•˜ë©´ íŒì •
  const needed = state._solution.length - 1;
  if (state.selected.length === needed) {
    const sum = state._hint + state.selected.reduce((s, i) => s + state.numbers[i], 0);
    if (sum === state.target) submitAnswer(); else showWrong();
  }
}

function showWrong() {
  document.querySelectorAll('.hint-box').forEach(b => b.classList.add('wrong-flash'));
  const area = document.querySelector('.target-area');
  area.classList.remove('wrong'); void area.offsetWidth; area.classList.add('wrong');
  setTimeout(() => {
    state.selected = [];
    document.querySelectorAll('.num-cell').forEach(c => c.classList.remove('selected'));
    area.classList.remove('wrong');
    renderFormula();
  }, 400);
}

function renderFormula() {
  const wrap = document.getElementById('hintFormula');
  wrap.innerHTML = '';

  // ì²« ë²ˆì§¸ ì¹¸: íŒíŠ¸ ìˆ«ì ê³ ì •
  const box0 = document.createElement('div');
  box0.className = 'hint-box filled';
  box0.textContent = state._hint;
  wrap.appendChild(box0);

  // ë‚˜ë¨¸ì§€ ì¹¸: ìœ ì € ì„ íƒ (easy/medium 1ì¹¸, hard 2ì¹¸)
  const remaining = state._solution.length - 1;
  for (let i = 0; i < remaining; i++) {
    const op = document.createElement('span'); op.className='hint-op'; op.textContent='+'; wrap.appendChild(op);
    const box = document.createElement('div');
    box.className = 'hint-box' + (i < state.selected.length ? ' filled' : '');
    box.textContent = i < state.selected.length ? state.numbers[state.selected[i]] : '?';
    wrap.appendChild(box);
  }

  const eq = document.createElement('span'); eq.className='hint-eq'; eq.textContent='='; wrap.appendChild(eq);
  const tgt = document.createElement('span'); tgt.className='hint-target'; tgt.textContent=state.target; wrap.appendChild(tgt);
}

function clearSelection() {
  state.selected = [];
  document.querySelectorAll('.num-cell').forEach(c => c.classList.remove('selected'));
  renderFormula();
}

function submitAnswer() {
  // ì‰¬ì›€: hint + ì„ íƒ ìˆ«ì, ë‚˜ë¨¸ì§€: ì„ íƒ ìˆ«ì í•©ì‚°
  const sum = state._hint + state.selected.reduce((s, i) => s + state.numbers[i], 0);
  if (sum !== state.target) return;
  state.qTimes.push(state.elapsed - state.qStart);

  // ì •ë‹µ ì…€ burst â†’ fillGreen ìˆœì„œë¡œ ì—°ì¶œ
  state.selected.forEach(i => {
    const cell = document.querySelector(`.num-cell[data-idx="${i}"]`);
    if (!cell) return;
    cell.classList.add('correct-burst');
    setTimeout(() => {
      cell.classList.remove('correct-burst', 'selected');
      cell.classList.add('used');
    }, 350);
  });

  // ë³„ íŒŒí‹°í´
  state.selected.forEach(i => {
    const cell = document.querySelector(`.num-cell[data-idx="${i}"]`);
    if (!cell) return;
    const rect = cell.getBoundingClientRect();
    launchStars(rect.left + rect.width / 2, rect.top + rect.height / 2);
  });

  // ìˆ˜ì‹ ì¹¸ì„ ì„ íƒê°’ìœ¼ë¡œ ê³ ì • (selected ë¹„ìš°ê¸° ì „ì—)
  const wrap = document.getElementById('hintFormula');
  wrap.querySelectorAll('.hint-box:not(.filled)').forEach((box, i) => {
    if (i < state.selected.length) {
      box.classList.add('filled');
      box.textContent = state.numbers[state.selected[i]];
    }
  });

  state.selected = [];
  state.qIndex++;

  const ANIM_DELAY = 600;

  if (state.qIndex >= TOTAL_Q) {
    clearInterval(state.timerInterval);
    setTimeout(() => showResult(), ANIM_DELAY);
  } else {
    setTimeout(() => {
    const cfg = LEVELS[state.level];
    const size = cfg.gridSize * cfg.gridSize;
    state.qStart = state.elapsed;
    const prevTarget = state.target;
    const solCount = cfg.solCount;
    let solutionNums, newTarget, attempts = 0;
    do {
      solutionNums = Array.from({length: solCount}, () => Math.floor(Math.random() * cfg.maxNum) + 1);
      newTarget = solutionNums.reduce((s, n) => s + n, 0);
      attempts++;
    } while (newTarget === prevTarget && attempts < 10);
    state.target = newTarget;
    state.numbers = Array.from({length: size}, () => {
      if (state.level === 'easy') return Math.floor(Math.random() * cfg.maxNum) + 1;
      let n;
      do { n = Math.floor(Math.random() * cfg.maxNum) + 1; } while (n >= state.target);
      return n;
    });
    const pick = shuffle([...Array(size).keys()]).slice(0, solCount);
    pick.forEach((idx, i) => { state.numbers[idx] = solutionNums[i]; });
    state._solution = pick;
    state._hint = solutionNums[0];
    state.selected = [];

    document.getElementById('puzzleNum').textContent = `${state.qIndex + 1} / ${TOTAL_Q}`;
    renderDots(); renderGrid();
    const targetArea = document.querySelector('.target-area');
    targetArea.classList.remove('slide-in'); void targetArea.offsetWidth; targetArea.classList.add('slide-in');
    renderFormula();
    }, ANIM_DELAY);
  }
}

function showResult() {
  const totalSec = (state.elapsed / 10).toFixed(1);
  const isNewRecord = state.best[state.level] === null || state.elapsed < state.best[state.level];
  if (isNewRecord) { state.best[state.level] = state.elapsed; state.cleared[state.level] = true; }

  document.getElementById('resIcon').textContent      = isNewRecord ? 'ğŸ†' : 'ğŸ‰';
  document.getElementById('resTitle').textContent     = isNewRecord ? 'ìµœê³ ê¸°ë¡ ê°±ì‹ !' : 'ì™„ë£Œ!';
  document.getElementById('resTotalTime').textContent = `${totalSec}ì´ˆ`;

  const qTimesWrap = document.getElementById('qTimes');
  qTimesWrap.innerHTML = '';
  const minTime = Math.min(...state.qTimes);
  state.qTimes.forEach((t, i) => {
    const chip = document.createElement('div');
    chip.className = 'q-time-chip' + (t === minTime ? ' best-q' : '');
    chip.innerHTML = `<span class="chip-label">${i+1}ë²ˆ</span><span class="chip-val">${(t/10).toFixed(1)}ì´ˆ</span>`;
    qTimesWrap.appendChild(chip);
  });

  const bestRow = document.getElementById('resBestRow');
  if (!isNewRecord && state.best[state.level] !== null) {
    bestRow.style.display = '';
    document.getElementById('resBest').textContent = `${(state.best[state.level]/10).toFixed(1)}ì´ˆ`;
  } else { bestRow.style.display = 'none'; }

  document.getElementById('resultCard').classList.toggle('new-record', isNewRecord);
  document.getElementById('overlay').classList.add('show');
  updateHomeDisplay();
  launchConfetti();
}

function replayLevel() {
  document.getElementById('overlay').classList.remove('show');
  document.getElementById('resultCard').classList.remove('new-record');
  startGame(state.level);
}

function startTimer() {
  const disp = document.getElementById('timerDisp');
  state.timerInterval = setInterval(() => {
    state.elapsed++;
    disp.textContent = `${(state.elapsed/10).toFixed(1)}ì´ˆ`;
  }, 100);
}

function startCountdown(onDone) {
  const overlay = document.getElementById('countdownOverlay');
  const numEl   = document.getElementById('countdownNum');
  let count = 3;
  document.getElementById('numGrid').style.pointerEvents = 'none';
  overlay.classList.add('show');
  numEl.style.color = 'var(--coral)'; numEl.textContent = count;
  numEl.style.animation = 'none'; void numEl.offsetWidth; numEl.style.animation = 'countPop 0.9s ease forwards';

  const tick = setInterval(() => {
    count--;
    if (count <= 0) {
      clearInterval(tick);
      numEl.textContent = 'GO!'; numEl.style.color = 'var(--grass)';
      numEl.style.textAlign = 'center';
      numEl.style.animation = 'none'; void numEl.offsetWidth; numEl.style.animation = 'countPop 0.7s ease forwards';
      setTimeout(() => {
        overlay.classList.remove('show'); numEl.style.color = '';
        document.getElementById('numGrid').style.pointerEvents = '';
        onDone();
      }, 700);
    } else {
      numEl.textContent = count;
      numEl.style.animation = 'none'; void numEl.offsetWidth; numEl.style.animation = 'countPop 0.9s ease forwards';
    }
  }, 1000);
}

function shuffle(arr) {
  for (let i = arr.length-1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return arr;
}

function launchStars(cx, cy) {
  const emojis = ['â­','ğŸŒŸ','âœ¨','ğŸ’›','ğŸŒˆ','ğŸ’–','ğŸµ','ğŸ”¥'];
  const count = 10;
  for (let i = 0; i < count; i++) {
    const star = document.createElement('div');
    star.className = 'star-particle';
    const emoji = emojis[Math.floor(Math.random() * emojis.length)];
    const size  = 1.1 + Math.random() * 0.9;
    star.style.fontSize = size + 'rem';
    star.style.left = cx + 'px';
    star.style.top  = cy + 'px';
    const angle = (i / count) * 360 + Math.random() * 20;
    const dist  = 60 + Math.random() * 80;
    const tx = Math.cos(angle * Math.PI / 180) * dist;
    const ty = Math.sin(angle * Math.PI / 180) * dist - 30;
    const rot = (Math.random() - 0.5) * 720 + 'deg';
    star.style.setProperty('--tx', tx + 'px');
    star.style.setProperty('--ty', ty + 'px');
    star.style.setProperty('--rot', rot);
    star.style.animationDuration = (0.45 + Math.random() * 0.35) + 's';
    star.style.animationDelay    = (i * 20) + 'ms';
    star.textContent = emoji;
    document.body.appendChild(star);
    setTimeout(() => star.remove(), 1000);
  }
}

function launchConfetti() {
  const colors = ['#6dd47e','#5bc8f5','#ffcc44','#ff7c6e','#b39ddb','#ffb347'];
  for (let i = 0; i < 60; i++) {
    setTimeout(() => {
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      el.style.left = Math.random()*100+'vw';
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.animationDuration = (1.5+Math.random()*2)+'s';
      el.style.borderRadius = Math.random()>0.5?'50%':'3px';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 3500);
    }, i*35);
  }
}
</script>
</body>
</html>
